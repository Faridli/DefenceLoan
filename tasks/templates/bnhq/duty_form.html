{% extends "dashboard/css.html" %}
{% load widget_tweaks %}
{% block title %}Create Group Duty{% endblock %}

{% block content %}
<main class="max-w-lg mx-auto bg-white p-6 mt-10 rounded-xl shadow">
    <h2 class="text-3xl font-bold mb-6 text-center">Create Group Duty</h2>

    <form method="POST">
        {% csrf_token %}
        <div class="grid grid-cols-1 gap-6 font-semibold text-lg">

            <!-- Member No Input -->
            <div>
                <label class="text-xl mb-2">Member No</label>
                <input type="text" name="member_no" id="id_member_no"
                       class="border-2 border-blue-400 rounded p-2 w-full mb-2"
                       placeholder="Type member no">
                <p class="text-gray-500 text-sm">Type member no to auto-fill name, rank, phone</p>
            </div>

            <!-- Multiple Members Select -->
            <div>
                <label class="text-xl mb-2">Select Members</label>
                {{ form.members|add_class:"border-2 border-blue-400 rounded p-2 w-full h-40 mb-2" }}
                <p class="text-gray-500 text-sm">Use Ctrl (Cmd) + Click to select multiple members</p>
            </div>

            <!-- Auto fields -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="text-xl">Name</label>
                    <input id="id_name" class="border-2 border-blue-400 rounded p-2 mb-2 w-full" readonly>
                </div>
                <div>
                    <label class="text-xl">Rank</label>
                    <input id="id_rank" class="border-2 border-blue-400 rounded p-2 mb-2 w-full" readonly>
                </div>
                <div>
                    <label class="text-xl">Phone</label>
                    <input id="id_phone" class="border-2 border-blue-400 rounded p-2 mb-2 w-full" readonly>
                </div>
            </div>

            <!-- Date -->
            <div>
                <label class="text-xl">Date</label>
                {{ form.date|add_class:"border-2 border-blue-400 rounded p-2 mb-2 w-full" }}
            </div>

            <!-- Time -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="text-xl">Start Time</label>
                    {{ form.start_time|add_class:"border-2 border-blue-400 rounded p-2 mb-2 w-full" }}
                </div>
                <div>
                    <label class="text-xl">End Time</label>
                    {{ form.end_time|add_class:"border-2 border-blue-400 rounded p-2 mb-2 w-full" }}
                </div>
            </div>

            <!-- Destination -->
            <div>
                <label class="text-xl">Destination</label>
                {{ form.destination|add_class:"border-2 border-blue-400 rounded p-2 mb-4 w-full" }}
            </div>

            <!-- Submit Button -->
            <div class="text-center">
                <button class="bg-blue-600 text-white text-2xl px-6 py-2 rounded hover:bg-green-700">
                    Save Duties
                </button>
            </div>
        </div>
    </form>
</main>

<script>
    const members = {
        {% for m in members %}
        "{{ m.no }}": {
            name: "{{ m.name }}",
            rank: "{{ m.get_rank_display }}",
            phone: "{{ m.phone }}"
        },
        {% endfor %}
    };

    // Member No typing → auto-fill
    const memberNoInput = document.getElementById("id_member_no");
    memberNoInput.addEventListener("input", function() {
        const no = this.value.trim();
        if (members[no]) {
            document.getElementById("id_name").value = members[no].name;
            document.getElementById("id_rank").value = members[no].rank;
            document.getElementById("id_phone").value = members[no].phone;
        } else {
            document.getElementById("id_name").value = "";
            document.getElementById("id_rank").value = "";
            document.getElementById("id_phone").value = "";
        }
    });

    // Multiple select → show first selected member
    const membersSelect = document.querySelector("select[name='members']");
    membersSelect.addEventListener("change", function() {
        const firstNo = this.selectedOptions[0]?.value;
        if (members[firstNo]) {
            document.getElementById("id_name").value = members[firstNo].name;
            document.getElementById("id_rank").value = members[firstNo].rank;
            document.getElementById("id_phone").value = members[firstNo].phone;
            // Optional: sync member_no input with first selected
            document.getElementById("id_member_no").value = firstNo;
        } else {
            document.getElementById("id_name").value = "";
            document.getElementById("id_rank").value = "";
            document.getElementById("id_phone").value = "";
            document.getElementById("id_member_no").value = "";
        }
    });
</script>
{% endblock %}
